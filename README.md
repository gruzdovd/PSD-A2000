# PSD-A2000
Проект по расчету **плотности электронов в фазовом пространстве (Phase Space Density)** во внешнем радиационном поясе Земли на основе **параболоидной модели магнитосферы A2000**. Метод позволяет переводить потоки электронов $j(E,\textbf{x},\alpha,t)$ в функцию плотности $f(\mu,K,L^\star,t)$, которя зависит от адиабатических инвариантов. Новая функция не зависит от адиабатических вариаций популяций частиц, а профили $f(L^*)$ позволяют судить о конкретном механизме ускорения электронов во время геомагнитных событий (локальное ускорение на волнах или радиальная диффузия). 

Входные данные:

  -потоки электронов в зависимости от питч-углов и энергий, например, по спутнику Van Allen Probes, прибор MagEIS-L3 (https://cdaweb.gsfc.nasa.gov/)

  -магнитне поле в точке измерений, например, например, по спутнику Van Allen Probes, прибор EMFISIS (https://cdaweb.gsfc.nasa.gov/)

  -координаты спутника в системе GSM (https://cdaweb.gsfc.nasa.gov/)

  -данные о солнечном ветре и наземных индексах геомагнитной активности для параболоидной модели: межпланетное магнитное поле $B_x,B_y,B_z$; плотность, скорость солнечного ветра; Dst,AL-индексы

Для расчетов нужно задать постоянные $\mu,K$.

Алгоритм: 

-для набора локальных питч-углов $\alpha \in [5;85]$ находятся зеркальные точки вдоль магнитной линии, считается интеграл $K=\int\limits_{З_Ю}^{З_С} \sqrt{B_{mirror}-B}ds$. данные интерполируются для поиска $\alpha(K_{target})$

-ищется кинетическая энергия, соответствующая заданным $\mu,K$

-зависимость $j(\alpha)$ аппроксимируется функцией $C_0 * \sin{\alpha} -{C_1} * (\sin{\alpha})^{C_2}$; ищется $j$ в точке $\alpha(K_{target})$ из первого шага; считается $f=j/p^2$ для всех энергий; аппроксимируется $f(E)$ для получения $f$ в энергии из второго шага

-трассируется дрейф электрона вокруг Земли: для каждого азимутального угла $\varphi$ ищется такая коширота $\theta$, для которой интегрирование вдоль магнитной линии с исходным $B_{mirror}$ даст $K_{target}$

Модель магнитого поля Земли A2000 полностью описана на Fortran (не мной, модель Alexeev 2000), Python вызывает подпрограммы через **ctypes** для трассировки магнитных линий и делает пост-обработку согласно алгоритму.

-`fortran/*.for` - исходники Fortran (модель A2000).

-`a2000_library.py` - обертка через ctypes.

-`main.py` - все функции и пример расчета PSD.

> Примечание: в `a2000_library.py` пути к динамической библиотеке локальные; для запуска их нужно подправить под свою систему. DLL от gfortran собирается командой `gfortran -shared -static-libgfortran -fPIC -ffixed-form -o a2000_module.dll a2000-field-line-f77.for a2012-v3_3-mlt-f77.for igrf13-sub-f77.for`

# Примеры вывода
![anim](https://github.com/user-attachments/assets/f207d95c-3076-406e-8c1d-9925d1db962f) Иллюстрация среза параболоидной модели полдень-полночь
![f(L*)](https://github.com/user-attachments/assets/9f0dd693-cb94-4f6b-8277-10885f72ab12) Профили f(L*) для $\mu=100 МэВ/Гс; K=700 Гс^{1/2}км$ (соответствует энергиям 300-600 кэВ) по параболоидной модели A2000 и по модели Цыганенко TS05.
